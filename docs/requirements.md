# 声纹识别 Demo 需求规格说明（v0.1）

## 1. 目标
构建一个可在电脑上持续运行的声纹识别 Demo，实现：
- 实时监听麦克风或电脑系统音频（如播客、音频流）。
- 自动提取声纹，对新说话人自动注册入库并编号（默认命名：`新人1`、`新人2`...）。
- 对已注册声纹进行持续匹配，UI 中高亮当前命中人员并显示置信度。
- 对“有声音但非人声”进行区分并显示为“背景噪声”。

## 2. 适用范围
- 形态：本地桌面应用（单机运行）。
- 输入：实时音频流（麦克风/系统音频）与离线测试音频（mp3/wav）。
- 输出：实时识别结果、说话人列表、日志与评估报告。

## 3. 用户故事
- 作为用户，我可以一键选择输入源（麦克风/系统音频）并启动监听。
- 作为用户，我希望系统自动发现新说话人并自动编号，不需要手动录入。
- 作为用户，我希望在列表中看到所有已注册说话人，以及当前命中谁、置信度多少。
- 作为用户，我希望系统能识别“非人声”，避免把噪声误当成新说话人。
- 作为开发者，我希望在提供 mp3 测试数据后，可由 AI 辅助完成开发、测试与修正闭环。

## 4. 功能需求（FR）
- `FR-01 输入源选择`：支持 `麦克风` 与 `系统音频` 两种采集模式，支持运行中切换。
- `FR-02 实时采集`：连续采集音频并按短帧（如 20~30ms）处理。
- `FR-03 语音活动检测`：区分有声/静音，对有声段进一步判断“人声/非人声”。
- `FR-04 声纹提取`：对检测为“人声”的片段提取 speaker embedding（当前实现采用 `Silero VAD + ECAPA-TDNN` 预训练模型）。
- `FR-05 自动注册`：当片段与库中所有说话人相似度均低于阈值，且满足最小时长/稳定性条件时，自动建档为 `新人N`。
- `FR-06 持续匹配`：实时计算输入片段与说话人库相似度，命中时高亮对应编号并展示置信度。
- `FR-07 列表展示`：UI 常驻展示所有已注册说话人（编号、创建时间、最近命中、样本数）。
- `FR-08 背景噪声展示`：检测为非人声时，UI 显示“背景噪声”，不触发注册流程。
- `FR-09 数据持久化`：说话人信息和声纹向量持久化保存，应用重启后可恢复。
- `FR-10 日志与回放`：记录事件日志（注册、命中、噪声）并可对离线 mp3 批处理输出结果。
- `FR-11 库作用域模式`：支持 `global`（跨音频/跨会话持久化）与 `session`（仅当前会话有效）双模式切换。

## 5. 非功能需求（NFR）
- `NFR-01 实时性`：端到端识别延迟目标 < 1.5s（Demo 环境）。
- `NFR-02 稳定性`：持续运行 2 小时不崩溃，内存无明显泄漏。
- `NFR-03 准确性`：在人声场景中，已注册说话人 Top1 命中率达到可演示水平（目标 >= 85%，后续随数据调参）。
- `NFR-04 可解释性`：每次命中输出相似度与置信度，便于调参。
- `NFR-05 可移植性`：优先支持 macOS，兼容 Windows（系统音频采集方式可按平台适配）。

## 6. 验收标准
- `AC-01` 可从 UI 选择输入源并成功开始/停止监听。
- `AC-02` 两名未注册说话人依次发言后，列表出现 `新人1`、`新人2`。
- `AC-03` 已注册说话人再次发言时，列表对应条目被高亮，且显示置信度（0~100%）。
- `AC-04` 播放纯音乐/环境噪声时，界面显示“背景噪声”，且不新增新人。
- `AC-05` 重启程序后仍可看到历史注册人员并继续匹配。
- `AC-06` 对给定 mp3 测试集可生成结构化评估报告（命中率、误报率、漏报率、噪声误检率）。
- `AC-07` 在 `session` 模式下结束会话后，临时库不保留到下一次启动。

## 7. 约束与风险
- 系统音频采集依赖平台能力：
  - macOS 通常需要虚拟声卡（如 BlackHole）做 loopback。
  - Windows 可使用 WASAPI loopback。
- 纯 Demo 阶段不保证司法级身份认证精度。
- 噪声复杂场景下，阈值需要按实际音频做标定。

## 8. AI 全自动交付范围（在提供测试音频后）
- 自动完成：代码生成、单元测试与回归测试脚本、评估报告生成、阈值建议、缺陷修复建议。
- 人工确认点：输入设备授权、系统音频回环设备配置、最终阈值和 UI 文案确认。
